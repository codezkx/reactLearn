# React源码学习

1. 老的react架构

   > Stack Reconciler -> Reconciler(协调器; diff算法) -> Renderer(渲染器)

2. 新的react架构

> Fiber Reconciler-> Reconciler(协调器; diff算法) -> Renderer(渲染器)

## Fiber 架构

###  Fiber的含义

1. 作为静态数据结构
   1. "Fiber" 可以被理解为一种静态数据结构，代表了 React 中一个组件或 DOM 元素的一个单元。它用来描述和保存 UI 树的状态，同时也是 React 用来调度和管理渲染任务的基础单元。
2. 作为动态工作单元
   1. 它也是一个动态的工作单元，用于管理和调度 React 应用的渲染过程。作为动态工作单元的 Fiber，其主要作用是在 React 渲染更新中分配、跟踪和协调工作。

### Fiber的数据结构

### Fiber的工作原理

1. 任务的可中断性和优先级调度
   1. **可中断性**: 在传统的 React 架构中，渲染是一个同步的过程，一旦开始，必须完成整个渲染任务，这在处理大量节点或复杂组件时，可能会导致浏览器卡顿。而 Fiber 架构允许 React 将渲染任务分成多个小的单元（称为“Fiber”），这些单元可以被中断、暂停、或恢复。这意味着在处理大量更新时，React 可以暂停当前任务，以处理更高优先级的任务（例如响应用户输入）。
   2. **优先级调度**: Fiber 使得 React 能够根据不同任务的重要性分配不同的优先级。
2. 分块渲染
   1. **时间分片（Time Slicing）**: Fiber 架构通过将渲染任务切分成更小的单元，并在浏览器的空闲时间段执行这些单元，避免了长时间的阻塞操作。这种“时间分片”的技术使得 React 能够在用户界面更新过程中保持流畅的体验。
3. 增量渲染
   1. **局部更新**: Fiber 架构允许 React 更高效地计算哪些部分的 UI 需要更新，并只更新这些部分。这种增量渲染的方式减少了不必要的渲染，从而提升了性能。
4. 更精细的错误处理
   1. **错误边界（Error Boundaries）**: Fiber 使得 React 能够更精细地捕获和处理渲染过程中发生的错误，而不会影响整个应用。这是通过允许在渲染阶段插入“错误边界”组件来实现的，提升了应用的稳定性和可维护性。
5. 更灵活的动画和布局计算
   1. **动画和布局**: Fiber 架构使 React 更好地处理复杂的动画和布局计算，因为它能够在高优先级任务和低优先级任务之间自由切换，避免卡顿和延迟。
6. **双缓存机制**:
   1. React 中通常存在两棵 Fiber 树：一个是当前已经渲染到屏幕上的 Fiber 树（当前树），另一个是正在准备中的 Fiber 树（工作树）。当新 Fiber 树准备好后，它会替换旧的 Fiber 树。这种双缓存机制可以有效避免渲染中出现不一致的情况。



